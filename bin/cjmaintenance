#!/usr/bin/php -f
<?php
if (isset($argv[1])) {
	$projname = "/".$argv[1];
} else {
	$projname = "";
}
$homedir = realpath(".").$projname;
$projdir = realpath(__DIR__."/..");
$p_jskit = $projdir."/JSKit";
$p_syslibs = $projdir."/syslibs";
$h_syslibs = $homedir."/syslibs";
// compile JSKit
$path = $p_jskit;
$dir = opendir($path);
$file_arr = array();
while ($fname = readdir($dir)) {
	if (is_dir("$path/$fname") == true || preg_match("/^\./", $fname) == true || preg_match("/^\d/", $fname) == false) {
		continue;
	}
	$file_arr[] = "$path/$fname";
}
sort($file_arr);
$compile = implode(" ", $file_arr);
system("coffee -b -o ".$h_syslibs." -c ".$p_syslibs);
system("coffee -j JSKit.js -b -o ".$h_syslibs." -w ".$compile);
?>
